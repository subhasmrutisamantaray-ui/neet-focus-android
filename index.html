<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NEET Focus</title>
<style>
  body { margin:0; font-family: Arial,sans-serif; height:100vh; background:black; color:white; }
  #top-left,#top-right { position:fixed; top:10px; font-size:14px; }
  #top-left{left:10px;} #top-right{right:10px;}
  #center {display:flex; flex-direction:column; align-items:center; justify-content:center; height:100%; text-align:center;}
  select,input,button {padding:10px; margin:6px; font-size:16px;}
  #timer {font-size:48px; margin:20px 0;}
  .break {background:#7a0000;}
  #lockOverlay {position:fixed; inset:0; background:rgba(0,0,0,0.95); color:white; font-size:32px; display:flex; align-items:center; justify-content:center; text-align:center; flex-direction:column; z-index:999; display:none;}
</style>
</head>
<body>

<div id="top-left">NEET in <span id="neet"></span></div>
<div id="top-right">Today: <span id="today">0</span> h</div>

<div id="center">
  <select id="subject">
    <option value="">Choose Subject</option>
    <option>Physics</option>
    <option>Chemistry</option>
    <option>Botany</option>
    <option>Zoology</option>
  </select>

  <select id="mode">
    <option value="lecture">Lecture</option>
    <option value="self">Self Study</option>
  </select>

  Focus <input type="number" id="focusMin" value="60" min="1"> min
  Break <input type="number" id="breakMin" value="10" min="1"> min

  <div id="timer">60:00</div>

  <button id="startBtn" onclick="start()">Start</button>
  <button onclick="resetAll()">Reset</button>
</div>

<div id="lockOverlay">COME BACK TO FOCUS</div>

<script>
let time=60*60, interval=null, phase="focus", subject="", activeMode="lecture";
const data = JSON.parse(localStorage.getItem("neet")||"{}");
if(!data.total) data.total={}; if(!data.days) data.days={}; if(!data.days[new Date().toISOString().slice(0,10)]) data.days[new Date().toISOString().slice(0,10)]={};

function todayKey(){return new Date().toISOString().slice(0,10);}
function save(){localStorage.setItem("neet",JSON.stringify(data));}
function updateNEET(){let n=new Date(),d=new Date("2026-05-03"),diff=Math.ceil((d-n)/(1000*60*60*24));document.getElementById("neet").textContent=diff+" days";}
function fmt(s){return String(Math.floor(s/60)).padStart(2,"0")+":"+String(s%60).padStart(2,"0");}

const lockOverlay=document.getElementById("lockOverlay");

function start(){
  subject=document.getElementById("subject").value;
  activeMode=document.getElementById("mode").value;
  if(!subject){alert("Choose subject"); return;}
  document.getElementById("startBtn").disabled=true;

  let focusMin=parseInt(document.getElementById("focusMin").value)||60;
  let breakMin=parseInt(document.getElementById("breakMin").value)||10;
  time=focusMin*60;

  interval=setInterval(()=>{
    time--;
    document.getElementById("timer").textContent=fmt(time);

    if(time<=0){
      clearInterval(interval);

      if(phase==="focus"){
        if(!data.days[todayKey()][subject]) data.days[todayKey()][subject]=0;
        data.days[todayKey()][subject]+=focusMin/60;
        data.total[subject]=(data.total[subject]||0)+focusMin/60;
        save();

        phase="break"; document.body.classList.add("break"); time=breakMin*60;
      }else{
        phase="focus"; document.body.classList.remove("break"); time=focusMin*60;
      }

      document.getElementById("startBtn").disabled=false;
      document.getElementById("timer").textContent=fmt(time);
    }
  },1000);
}

function resetAll(){
  clearInterval(interval); interval=null;
  phase="focus"; time=parseInt(document.getElementById("focusMin").value)*60;
  document.body.classList.remove("break");
  document.getElementById("timer").textContent=fmt(time);
  document.getElementById("startBtn").disabled=false;
}

// SELF-STUDY LOCK
window.addEventListener("blur", ()=>{
  if(activeMode==="self" && interval){
    clearInterval(interval); interval=null;
    lockOverlay.style.display="flex";
  }
});
window.addEventListener("focus", ()=>{
  if(activeMode==="self" && !interval){
    lockOverlay.style.display="none"; start();
  }
});

updateNEET();
</script>

</body>
</html>
