<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NEET Focus</title>
<style>
  body { 
    margin:0; 
    font-family: Arial,sans-serif; 
    height:100vh; 
    background: radial-gradient(circle at center, #0a2a1f 0%, #000 70%); 
    color:white; 
    transition: background 0.3s; 
  }

  body.focus { 
    animation: ambientPulse 20s ease-in-out infinite; 
  }

  @keyframes ambientPulse {
    0% { background: radial-gradient(circle at center, #0a2a1f 0%, #000 70%); }
    50% { background: radial-gradient(circle at center, #0c3a26 0%, #000 70%); }
    100% { background: radial-gradient(circle at center, #0a2a1f 0%, #000 70%); }
  }

  .break { background:#7a0000; }

  #top-left,#top-right { position:fixed; top:10px; font-size:14px; }
  #top-left{left:10px;} #top-right{right:10px;}
  
  #center {display:flex; flex-direction:column; align-items:center; justify-content:center; height:100%; text-align:center;}
  select,input,button {padding:10px; margin:6px; font-size:16px;}
  #timer {font-size:48px; margin:20px 0;}
  
  #lockOverlay {position:fixed; inset:0; background:rgba(0,0,0,0.95); color:white; font-size:32px; display:flex; align-items:center; justify-content:center; text-align:center; flex-direction:column; z-index:999; display:none;}
</style>
</head>
<body class="focus">

<div id="top-left">NEET in <span id="neet"></span></div>
<div id="top-right">
  Mode: <span id="modeLabel">—</span><br>
  Subject: <span id="subjectLabel">—</span><br>
  Today: <span id="todayHours">0</span> h<br>
  Total: <span id="totalHours">0</span> h
</div>

<div id="center">
  <select id="subject">
    <option value="">Choose Subject</option>
    <option>Physics</option>
    <option>Chemistry</option>
    <option>Botany</option>
    <option>Zoology</option>
  </select>

  <select id="mode">
    <option value="lecture">Lecture</option>
    <option value="self">Self Study</option>
  </select>

  Focus <input type="number" id="focusMin" value="60" min="1"> min
  Break <input type="number" id="breakMin" value="10" min="1"> min

  <div id="timer">60:00</div>

  <button id="startBtn" onclick="start()">Start</button>
  <button onclick="resetAll()">Reset</button>
</div>

<div id="lockOverlay">COME BACK TO FOCUS</div>

<script>
let time=60*60, interval=null, phase="focus", subject="", activeMode="lecture", focusSeconds=0;
const data = JSON.parse(localStorage.getItem("neet")||"{}");
const subjects=["Physics","Chemistry","Botany","Zoology"];

if(!data.total) data.total={}; 
if(!data.days) data.days={}; 
if(!data.days[new Date().toISOString().slice(0,10)]) data.days[new Date().toISOString().slice(0,10)]={};

function todayKey(){return new Date().toISOString().slice(0,10);}
function save(){localStorage.setItem("neet",JSON.stringify(data));}
function updateNEET(){let n=new Date(),d=new Date("2026-05-03"),diff=Math.ceil((d-n)/(1000*60*60*24));document.getElementById("neet").textContent=diff+" days";}
function fmt(s){return String(Math.floor(s/60)).padStart(2,"0")+":"+String(s%60).padStart(2,"0");}

const lockOverlay=document.getElementById("lockOverlay");

function updateStats(){
  if(!subject) return;
  document.getElementById("modeLabel").textContent=activeMode.toUpperCase();
  document.getElementById("subjectLabel").textContent=subject;
  const today=data.days[todayKey()][subject]||0;
  document.getElementById("todayHours").textContent = today;
  document.getElementById("totalHours").textContent = data.total[subject]||0;
}

function start(){
  subject=document.getElementById("subject").value;
  activeMode=document.getElementById("mode").value;
  if(!subject){alert("Choose subject"); return;}

  document.getElementById("startBtn").disabled=true;
  document.getElementById("focusMin").disabled=true;
  document.getElementById("breakMin").disabled=true;
  document.getElementById("subject").disabled=true;
  document.getElementById("mode").disabled=true;

  let focusMin=parseInt(document.getElementById("focusMin").value)||60;
  let breakMin=parseInt(document.getElementById("breakMin").value)||10;
  time=(phase==="focus"?focusMin:breakMin)*60;
  focusSeconds=0;
  updateStats();

  interval=setInterval(()=>{
    time--;
    document.getElementById("timer").textContent=fmt(time);

    if(phase==="focus") focusSeconds++;

    // Only count completed hours (>=1h)
    if(focusSeconds>=3600){
      if(!data.days[todayKey()][subject]) data.days[todayKey()][subject]=0;
      data.days[todayKey()][subject]+=1;
      data.total[subject]=(data.total[subject]||0)+1;
      save();
      focusSeconds-=3600;
      updateStats();
    }

    if(time<=0){
      clearInterval(interval);

      let focusMin=parseInt(document.getElementById("focusMin").value)||60;
      let breakMin=parseInt(document.getElementById("breakMin").value)||10;

      if(phase==="focus"){
        phase="break"; document.body.classList.add("break"); time=breakMin*60;
      }else{
        phase="focus"; document.body.classList.remove("break"); time=focusMin*60; focusSeconds=0;
      }

      document.getElementById("startBtn").disabled=false;
      document.getElementById("timer").textContent=fmt(time);
    }
  },1000);
}

function resetAll(){
  clearInterval(interval); interval=null;
  phase="focus"; time=parseInt(document.getElementById("focusMin").value)*60;
  document.body.classList.remove("break");
  document.getElementById("timer").textContent=fmt(time);
  document.getElementById("startBtn").disabled=false;

  document.getElementById("focusMin").disabled=false;
  document.getElementById("breakMin").disabled=false;
  document.getElementById("subject").disabled=false;
  document.getElementById("mode").disabled=false;
  updateStats();
}

// SELF-STUDY LOCK
window.addEventListener("blur", ()=>{
  if(activeMode==="self" && interval){
    clearInterval(interval); interval=null;
    lockOverlay.style.display="flex";
  }
});
window.addEventListener("focus", ()=>{
  if(activeMode==="self" && !interval){
    lockOverlay.style.display="none"; start();
  }
});

updateNEET();
updateStats();
</script>

</body>
</html>
